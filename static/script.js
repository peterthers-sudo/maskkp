async function getJSON(url, opts){const res=await fetch(url,opts);if(!res.ok)throw new Error(res.status);return await res.json();}
const els={levelValue:document.getElementById('levelValue'),maxLevel:document.getElementById('maxLevel'),safeValue:document.getElementById('safeValue'),eduName:document.getElementById('eduName'),eduCutoff:document.getElementById('eduCutoff'),questionText:document.getElementById('questionText'),options:document.getElementById('options'),feedback:document.getElementById('feedback'),smallMessage:document.getElementById('smallMessage'),bigMessage:document.getElementById('bigMessage'),bigQuestion:document.getElementById('bigQuestion'),postAnswerActions:document.getElementById('postAnswerActions'),stayBtn:document.getElementById('stayBtn'),continueBtn:document.getElementById('continueBtn'),resetBtn:document.getElementById('resetBtn')};
const welcome=document.getElementById('welcomeScreen');const startBtn=document.getElementById('startBtn');const quizCard=document.getElementById('quizCard');const statusBar=document.getElementById('statusBar');
startBtn.onclick=()=>{welcome.style.display='none';quizCard.style.display='block';statusBar.style.display='flex';loadState();};
function showSplash(text,type){const splash=document.getElementById('splash');splash.textContent=text;splash.className='splash '+(type==='correct'?'correct':'wrong');splash.style.display='block';setTimeout(()=>{splash.style.display='none';},2000);}
async function loadState(){const s=await getJSON('/state');els.levelValue.textContent=s.level;els.maxLevel.textContent=s.max_level;els.safeValue.textContent=s.safe_level;renderQuestion(s.question);els.postAnswerActions.style.display='none';els.smallMessage.textContent='';els.bigMessage.textContent='';els.bigQuestion.textContent='';}
function renderQuestion(q){els.eduName.textContent=q.edu;els.eduCutoff.textContent=q.cutoff;els.questionText.textContent=q.question;els.options.innerHTML='';q.options.forEach(opt=>{const b=document.createElement('button');b.textContent=opt;b.onclick=()=>submitAnswer(opt,b);els.options.appendChild(b);});}
async function submitAnswer(opt,btn){[...els.options.querySelectorAll('button')].forEach(b=>b.disabled=true);try{const res=await getJSON('/answer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({answer:opt})});showSplash(res.result==='correct'?'Rigtigt!':'Forkert!',res.result);setTimeout(()=>{if(res.result==='correct'){els.smallMessage.textContent='Du er nu optaget pÃ¥';els.bigMessage.textContent=res.message.replace('Du er nu optaget pÃ¥ ','');els.bigQuestion.textContent=res.finished?'ðŸŽ“ Du har klaret hele quizzen!':'Vil du blive â€“ eller gÃ¥ videre mod '+res.next_edu+'?';els.postAnswerActions.style.display=res.finished?'none':'flex';}else{els.smallMessage.textContent='';els.bigMessage.textContent=res.message;els.bigQuestion.textContent='';els.postAnswerActions.style.display='none';}},2000);}catch(e){console.error(e);}}
els.stayBtn.onclick=async()=>{const r=await getJSON('/stay',{method:'POST'});els.bigMessage.textContent=r.message;els.bigQuestion.textContent='';els.postAnswerActions.style.display='none';};
els.continueBtn.onclick=async()=>{await loadState();};
els.resetBtn.onclick=async()=>{await getJSON('/reset',{method:'POST'});await loadState();};
